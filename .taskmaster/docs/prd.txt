# HR AI Agent - Product Requirements Document

> **중요**: 모든 태스크(title, description, details, testStrategy)를 **한국어**로 작성해주세요.

## 프로젝트 개요

HR 도메인 AI Agent 시스템. 자연어로 HR 데이터 분석(SQL Agent)과 사규 검색(RAG Agent)을 처리하는 Multi-Agent 시스템.

### 현재 상태 (v1.0 완성)
- SQL Agent: Text-to-SQL, Self-Correction, 스키마 자동 인식
- RAG Agent: PDF 로드, FAISS 벡터 검색
- Router: LLM Few-shot 의도 분류, SQL/RAG 자동 분기
- Infra: FastAPI 3-tier, Streamlit 채팅 UI, Docker Compose

### 기술 스택
- Python 3.11+, LangGraph 0.2.60, LangChain 0.3.27
- OpenAI gpt-4o-mini, FAISS, MySQL 8.0
- FastAPI, Streamlit, Docker Compose

---

## 성공 지표 (KPIs)

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| RAG 검색 정확도 | 85% 이상 | RAGAS Context Precision |
| SQL 실행 성공률 | 80% 이상 | Execution Accuracy |
| 평균 응답 시간 | 3초 이내 | LangSmith 트레이싱 |
| 위험 쿼리 차단율 | 100% | Guardrails 테스트 |

---

## v1.1 - 평가/모니터링 (우선순위 1)

### 목표
RAG와 SQL Agent의 품질 측정 및 Production-ready 모니터링 환경 구축.

### 요구사항

#### 1.1.1 RAGAS 평가
- Faithfulness (답변이 컨텍스트에 충실한지)
- Answer Relevancy (답변이 질문에 관련있는지)
- Context Precision (검색 결과의 정확도)
- 평가 데이터셋 구축 (최소 20개 질문-답변 쌍)
- 수용 기준: RAGAS 종합 점수 0.7 이상

#### 1.1.2 SQL 평가
- Execution Accuracy 측정 (실행 성공률)
- 예상 결과와 실제 결과 비교
- 평가 데이터셋 구축 (최소 20개 SQL 질문)
- 수용 기준: 정확도 80% 이상

#### 1.1.3 LangSmith 연동
- 트레이싱 설정 (LANGCHAIN_TRACING_V2)
- 각 Agent 호출 로깅
- 에러 추적 및 디버깅
- 응답 시간 메트릭 수집
- 수용 기준: 모든 요청 트레이싱 가능, 대시보드 구축

#### 1.1.4 비즈니스 임팩트 측정
- Baseline 성능 측정 (개선 전)
- 개선 후 비교 리포트 생성
- 수용 기준: 측정 가능한 개선 수치 문서화

---

## v1.2 - Guardrails + Safety (우선순위 2)

### 목표
Enterprise 환경에서 요구하는 안전성과 거버넌스 체계 구축.

### 요구사항

#### 1.2.1 입출력 필터링
- PII (개인정보) 마스킹 (이름, 전화번호, 이메일 등)
- 욕설/부적절한 표현 차단
- 프롬프트 인젝션 방어
- 수용 기준: 민감 정보 100% 마스킹

#### 1.2.2 SQL Query Validation
- SQL 파싱으로 문법 검증
- SELECT만 허용 (INSERT, UPDATE, DELETE 차단)
- 위험 키워드 차단 (DROP, TRUNCATE, ALTER)
- 수용 기준: 위험 쿼리 100% 차단

#### 1.2.3 Human-in-the-loop
- 위험도 높은 쿼리 승인 플로우
- 확신도 낮은 응답에 대한 경고 표시
- 관리자 승인 대기 상태 구현
- 수용 기준: 위험 쿼리 실행 전 사용자 확인

#### 1.2.4 Rate Limiting
- API 호출 횟수 제한
- 사용자별 쿼터 관리
- 수용 기준: 분당 요청 제한 동작

---

## v1.3 - RAG 고도화 (우선순위 3)

### 목표
검색 품질 향상을 위한 고급 RAG 기법 적용.

### 요구사항

#### 1.3.1 Hybrid Search
- BM25 키워드 검색 + FAISS 벡터 검색 결합
- 앙상블 가중치 조절 (기본 0.5:0.5)
- rank_bm25 또는 LangChain BM25Retriever 사용
- 수용 기준: 단순 벡터 검색 대비 정확도 10% 향상

#### 1.3.2 Re-ranking
- Cross-encoder 모델로 검색 결과 재정렬
- sentence-transformers/cross-encoder 사용
- Top-K 후 Re-rank로 상위 N개 선택
- 수용 기준: 검색 품질 RAGAS 점수 향상

#### 1.3.3 Query Rewriting
- LLM으로 사용자 질문을 검색 최적화 형태로 변환
- 오타 교정, 키워드 추출
- 질문 확장 (동의어 포함)
- 수용 기준: 모호한 질문에서 검색 성공률 향상

---

## v1.4 - UX 개선 (우선순위 4)

### 목표
사용자 경험 향상을 위한 실시간 응답 스트리밍과 대화 맥락 유지 기능 구현.

### 요구사항

#### 1.4.1 Streaming 응답
- Streamlit st.empty()와 LangChain stream() 연동
- SSE(Server-Sent Events) 방식으로 실시간 토큰 출력
- ChatGPT처럼 타이핑 효과 구현
- 수용 기준: 첫 토큰이 1초 이내 출력 시작

#### 1.4.2 대화 히스토리
- ConversationBufferMemory 적용
- 세션별 대화 기록 유지
- 최대 10턴 히스토리 보관
- 수용 기준: 이전 대화 참조 가능

#### 1.4.3 Multi-turn 대화
- 이전 대화 컨텍스트 참조 기능
- "그 직원의 급여는?" 같은 대명사 해석
- 컨텍스트 윈도우 관리
- 수용 기준: 연속 질문에서 문맥 유지

---

## 배포 및 데모

### 배포 환경
- Docker Compose 기반 원클릭 배포
- MySQL + FastAPI + Streamlit 컨테이너 오케스트레이션
- 환경 변수 기반 설정 관리

### 데모 자료
- GitHub README에 GIF/스크린샷 포함
- 주요 기능별 데모 시나리오 문서화
- (선택) 실제 동작하는 데모 URL

---

## 스킵 항목

다음 항목은 현재 범위에서 제외:
- Router 고도화 (취업 포트폴리오 목적상 불필요)
- Schema Linking (우선순위 낮음)
- v3.0 엔터프라이즈 기능 (오버스펙)

---

## 포트폴리오 어필 포인트

1. **Production Mindset**: RAGAS/LangSmith로 품질 측정 및 모니터링
2. **Enterprise Ready**: Guardrails, Human-in-the-loop, PII 마스킹
3. **기술적 깊이**: Hybrid Search, Re-ranking, Query Rewriting
4. **Multi-Agent 설계**: LangGraph 기반 SQL/RAG Agent 라우팅
5. **End-to-End**: 데이터 → Agent → API → UI → 배포까지 전체 파이프라인

---

## 기술 제약사항

- Python 3.11+ 필수
- OpenAI API 키 필요 (gpt-4o-mini)
- MySQL 8.0 Docker 컨테이너
- FAISS CPU 버전 사용
- LangChain 0.3.x LCEL 문법 준수
